#!/bin/sh
uses(){
	echo -e 'using\n$0 file_codeswarm.xml'
}

generatelog(){
	echo "genereting... "
	state=("\\" "|" "/" "—")
	i=0
	if [ -f "$1" ]; then
		result=${1%.*}'.log'
		echo -n > $result
		grep -e "event " $1 | \
		sed -e "s/^[ 	]*//;s/^<event //g;s|/>$||g" | \
		while read line
		do
			date=""
			eval $line;
			[ -n "$date" ] && echo "$date|$author|$action|$filename" >> $result
			echo -ne "\b${state[$i]}"
			(( i += 1 ))
			[[ $i -eq 5 ]] && i=0
		done 
		echo -ne "\bcompleted!"
	else
		echo -e "file log code_swarm not exsits!\n$1"
	fi
}

[ -n "$1" ] && generatelog $1 || uses 